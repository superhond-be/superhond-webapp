import express from "express";
import Database from "better-sqlite3";

const router = express.Router();
const db = new Database("superhond.db");

// Zorg dat de tabel bestaat
db.exec(`
  CREATE TABLE IF NOT EXISTS classes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    location TEXT,
    date TEXT NOT NULL,
    time TEXT NOT NULL,
    max_participants INTEGER
  )
`);

// ➕ Nieuwe les toevoegen
router.post("/", (req, res) => {
  const { title, location, date, time, max_participants } = req.body;
  const stmt = db.prepare(
    "INSERT INTO classes (title, location, date, time, max_participants) VALUES (?, ?, ?, ?, ?)"
  );
  const result = stmt.run(title, location, date, time, max_participants);
  res.json({ success: true, id: result.lastInsertRowid });
});

// 📋 Alle lessen ophalen
router.get("/", (req, res) => {
  const stmt = db.prepare("SELECT * FROM classes ORDER BY date, time");
  const classes = stmt.all();
  res.json(classes);
});

// ❌ Les annuleren
router.delete("/:id", (req, res) => {
  const stmt = db.prepare("DELETE FROM classes WHERE id = ?");
  stmt.run(req.params.id);
  res.json({ success: true });
});

export default router;
