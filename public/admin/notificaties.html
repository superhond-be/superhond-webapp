<!doctype html><html lang="nl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Meldingen â€“ Admin</title>
<style>
body{font-family:system-ui,sans-serif;max-width:900px;margin:24px auto;padding:0 16px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
.badge{padding:2px 8px;border-radius:999px;font-size:12px;color:#fff;background:#1976d2}
.badge.type-credit_used{background:#1976d2}
.badge.type-lesson_signup{background:#2e7d32}
.badge.type-credits_approved{background:#388e3c}
.badge.type-validity_extended{background:#0288d1}
.badge.type-credit_added{background:#7b1fa2}
.badge.type-dog_birthday{background:#f4a000}
.badge.type-system_error{background:#000}
</style>
</head><body>
<h1>ğŸ”” Meldingen (Admin)</h1>
<div style="margin:10px 0;font-size:13px;color:#555">
  <strong>Legenda:</strong><br>
  <span class="badge type-lesson_signup">lesson_signup</span> ğŸŸ¢ = Nieuwe lesaanmelding<br>
  <span class="badge type-credit_used">credit_used</span> ğŸ”µ = Credit verbruikt<br>
  <span class="badge type-credits_approved">credits_approved</span> âœ… = Credits goedgekeurd<br>
  <span class="badge type-credit_added">credit_added</span> â• = Extra credits toegekend<br>
  <span class="badge type-validity_extended">validity_extended</span> â³ = Geldigheid verlengd<br>
  <span class="badge type-dog_birthday">dog_birthday</span> ğŸ‚ = Verjaardag hond<br>
  <span class="badge type-system_error">system_error</span> âš ï¸ = Systeemfout<br>
  <span class="badge type-warning">warning</span> â— = Waarschuwing / urgent bericht
</div>
<table><thead><tr><th>Datum</th><th>Type</th><th>Bericht</th><th></th></tr></thead>
<tbody id="rows"></tbody></table>
<script>
const $=s=>document.querySelector(s);
async function load(){
  const r=await fetch('/api/admin/notifications',{credentials:'include'});
  const data=await r.json();
  const rows=$('#rows'); rows.innerHTML='';
  (data.items||[]).sort((a,b)=>a.created_at.localeCompare(b.created_at)).reverse().forEach(n=>{
    rows.insertAdjacentHTML('beforeend',`
      <tr data-id="${n.id}">
        <td>${new Date(n.created_at).toLocaleString()}</td>
        <td><span class="badge type-${n.type}">${n.type}</span></td>
        <td>${n.message}</td>
        <td>${n.seen_by_admin? '': '<button data-seen="'+n.id+'">Gelezen</button>'}</td>
      </tr>`);
  });
  rows.querySelectorAll('[data-seen]').forEach(b=>{
    b.onclick=async()=>{ await fetch('/api/admin/notifications/'+b.dataset.seen+'/seen',{method:'POST',credentials:'include'}); load(); };
  });
}
load();
</script>
</body></html>
