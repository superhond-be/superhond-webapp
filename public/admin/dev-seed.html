<!doctype html><html lang="nl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dev seed ‚Äì test-aanmelding</title>
<style>
  body{font-family:system-ui,sans-serif;max-width:900px;margin:24px auto;padding:0 16px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  button{padding:6px 10px;border:1px solid #ccc;border-radius:6px;cursor:pointer}
  .muted{color:#666}
</style>
</head><body>
<h1>üß™ Test-aanmelding maken</h1>
<p class="muted">Kies een <b>open</b> sessie en klik op <i>Maak test-aanmelding</i>. Dit maakt een <b>pending</b> inschrijving (dummy klant/hond).</p>
<table>
  <thead><tr><th>Start</th><th>Capaciteit</th><th>Status</th><th>Actie</th></tr></thead>
  <tbody id="rows"></tbody>
</table>
<div id="msg" class="muted" style="margin-top:10px"></div>

<script>
const api=(p,opt={})=>fetch(p,{credentials:'include',headers:{'Content-Type':'application/json'},...opt});
const $=s=>document.querySelector(s);

async function load(){
  const r=await api('/api/sessions');           // admin cookie wordt meegestuurd
  const sessions=await r.json();
  const rows=$('#rows'); rows.innerHTML='';
  sessions
    .filter(s=> (s.status||'open')==='open')
    .sort((a,b)=>a.start_iso.localeCompare(b.start_iso))
    .forEach(s=>{
      const rest=(s.capacity-(s.enrolled||0));
      rows.insertAdjacentHTML('beforeend',`
        <tr>
          <td>${s.start_iso}</td>
          <td>${s.enrolled||0}/${s.capacity} (resterend: ${rest})</td>
          <td>${s.status||'open'}</td>
          <td><button data-id="${s.id}">Maak test-aanmelding</button></td>
        </tr>
      `);
    });

  rows.querySelectorAll('button[data-id]').forEach(btn=>{
    btn.onclick=async()=>{
      const session_id=btn.dataset.id;
      // dummy klant/hond
      const body={
        session_id,
        klant:{ naam:'Test Klant', email:'test+superhond@example.com', tel:'+3200000000' },
        hond:{  naam:'Test Hond',  ras:'', gebdatum:'' }
      };
      const rr=await fetch('/api/public/enroll',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
      const data=await rr.json();
      if(rr.ok){
        $('#msg').textContent='‚úîÔ∏è Pending inschrijving aangemaakt (id: '+data.enrollment.id+'). Kijk in Aanmeldingen.';
      }else{
        $('#msg').textContent='‚ùå Fout: '+(data.error||'unknown');
      }
    };
  });
}
load();
</script>
</body></html>
