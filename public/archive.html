<!doctype html><html lang="nl"><head><meta charset="utf-8">
<title>Archief</title><link rel="stylesheet" href="css/app.css"></head>
<body>
<h1>Archief</h1>
<input id="searchBar" type="text" placeholder="Zoek in archief...">
<div class="exportRow">
  <button class="btn" id="exportCSV">Export CSV</button>
  <button class="btn" id="exportXLSX">Export Excel</button>
</div>

<div class="section">
  <div class="section-header"><h2 id="custHead">Klanten</h2><button class="btn-small" id="sortCust">Sorteer A–Z</button></div>
  <ul id="archCust"></ul>
</div>

<div class="section">
  <div class="section-header"><h2 id="dogHead">Honden</h2><button class="btn-small" id="sortDog">Sorteer A–Z</button></div>
  <ul id="archDog"></ul>
</div>

<div class="section">
  <div class="section-header"><h2 id="cardHead">Strippenkaarten</h2><button class="btn-small" id="sortCard">Sorteer A–Z</button></div>
  <ul id="archCard"></ul>
</div>

<div class="version">Superhond Webapp – v13</div>

<script src="js/data.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
function render(list,el,fmt){ el.innerHTML=list.map(fmt).join('') || '<li class="small">Geen</li>'; }

function refresh(){
  const q=document.querySelector('#searchBar').value.toLowerCase();
  window.filtered={};
  window.filtered.customers=window.SH.archived.customers.filter(c=>c.name.toLowerCase().includes(q));
  window.filtered.dogs=window.SH.archived.dogs.filter(d=>d.name.toLowerCase().includes(q));
  window.filtered.cards=window.SH.archived.cards.filter(c=>(c.type+' '+c.dogId).toLowerCase().includes(q));
  render(window.filtered.customers,document.querySelector('#archCust'),c=>'<li>'+c.name+'</li>');
  render(window.filtered.dogs,document.querySelector('#archDog'),d=>'<li>'+d.name+'</li>');
  render(window.filtered.cards,document.querySelector('#archCard'),c=>'<li>'+c.type+' ('+c.dogId+')</li>');
  document.querySelector('#custHead').textContent='Klanten ('+window.filtered.customers.length+')';
  document.querySelector('#dogHead').textContent='Honden ('+window.filtered.dogs.length+')';
  document.querySelector('#cardHead').textContent='Strippenkaarten ('+window.filtered.cards.length+')';
}

function exportCSV(){
  let rows=[];
  rows.push(['--- Klanten ---']); rows=rows.concat(window.filtered.customers.map(c=>[c.id,c.name]));
  rows.push([]); rows.push(['--- Honden ---']); rows=rows.concat(window.filtered.dogs.map(d=>[d.id,d.name]));
  rows.push([]); rows.push(['--- Strippenkaarten ---']); rows=rows.concat(window.filtered.cards.map(c=>[c.id,c.type,c.dogId]));
  let csv=rows.map(r=>r.join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='archief.csv'; a.click();
}

function exportXLSX(){
  const wb=XLSX.utils.book_new();
  const ws1=XLSX.utils.json_to_sheet(window.filtered.customers);
  const ws2=XLSX.utils.json_to_sheet(window.filtered.dogs);
  const ws3=XLSX.utils.json_to_sheet(window.filtered.cards);
  XLSX.utils.book_append_sheet(wb,ws1,'Klanten');
  XLSX.utils.book_append_sheet(wb,ws2,'Honden');
  XLSX.utils.book_append_sheet(wb,ws3,'Strippenkaarten');
  XLSX.writeFile(wb,'archief.xlsx');
}

document.addEventListener('DOMContentLoaded',()=>{
  refresh();
  document.querySelector('#searchBar').addEventListener('input',refresh);
  document.querySelector('#sortCust').addEventListener('click',()=>{window.SH.archived.customers.sort((a,b)=>a.name.localeCompare(b.name,'nl'));refresh();});
  document.querySelector('#sortDog').addEventListener('click',()=>{window.SH.archived.dogs.sort((a,b)=>a.name.localeCompare(b.name,'nl'));refresh();});
  document.querySelector('#sortCard').addEventListener('click',()=>{window.SH.archived.cards.sort((a,b)=>a.type.localeCompare(b.type,'nl'));refresh();});
  document.querySelector('#exportCSV').addEventListener('click',exportCSV);
  document.querySelector('#exportXLSX').addEventListener('click',exportXLSX);
});
</script>
</body></html>