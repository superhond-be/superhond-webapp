// public/app.js
const formEl = document.getElementById("register-form");
const dogFileEl = document.getElementById("dogPhoto");
const previewBox = document.getElementById("dog-preview");
const resultBox = document.getElementById("result");
const reloadBtn = document.getElementById("reloadBtn");

// Preview van de gekozen foto
dogFileEl.addEventListener("change", () => {
      .container { max-width: 980px; margin: 24px auto; padding: 0 16px; }
     .card { background:#151923; border:1px solid #2d3340; border-radius:12px; padding:16px; }
     .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
     .row-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
     label { display:block; font-weight:600; margin:8px 0 6px; }
        input, select { width:100%; background:#0f1115; color:#e6e9ef; border:1px solid #2d3340; border-radius:8px; padding:10px; }
     fieldset { border:1px solid #2d3340; border-radius:12px; margin:14px 0; padding:12px; }
     legend { padding:0 6px; color:#9fb3ff; }
     .actions { display:flex; gap:8px; align-items:center; }
       button { background:#1f8b4c; color:#fff; border:0; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; }
       .ghost { background:transparent; border:1px solid #2d3340; color:#e6e9ef; }
      #dog-preview img { max-width:160px; max-height:160px; object-fit:cover; border-radius:8px; border:1px solid #2d3340; }
     .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
     .brand { font-size:24px; font-weight:800; letter-spacing:.3px; }
     nav a { color:#cbd5ff; text-decoration:none; margin-left:10px; }
   </style> 


const file = dogFileEl.files?.[0];
  if (!file) {
    previewBox.innerHTML = "Nog geen foto geselecteerd.";
    return;
  }
  const url = URL.createObjectURL(file);
  previewBox.innerHTML = `<img src="${url}" alt="Voorbeeld hond" />`;
});

// Herladen knopje
reloadBtn.addEventListener("click", () => location.reload());

// Submit: multipart/form-data met FormData (inclusief foto)
formEl.addEventListener("submit", async (e) => {
  e.preventDefault();
  resultBox.textContent = "Versturen…";

  const fd = new FormData(formEl);

  // voeg foto toe (name="dogPhoto" komt al uit index.html)
  if (dogFileEl.files?.[0]) {
    fd.set("dogPhoto", dogFileEl.files[0]);
  }

  try {
    const res = await fetch("/api/customers/register", {
      method: "POST",
      body: fd
      // géén headers hier — browser zet multipart boundary zelf
    });

    const data = await res.json();
    if (!res.ok) {
      throw new Error(data?.error || "Onbekende fout");
    }

    // Toon resultaat
    const { customer, dog } = data;
    const photo = dog?.photoUrl
      ? `<img src="${dog.photoUrl}" alt="hond" style="max-width:120px;border-radius:8px;border:1px solid #334155" />`
      : "<em>geen foto</em>";

    resultBox.innerHTML = `
      <div class="ok"><strong>✔ Geregistreerd!</strong></div>
      <div style="display:flex; gap:16px; align-items:flex-start; margin-top:8px">
        <div>${photo}</div>
        <div>
          <div><strong>Klant:</strong> ${customer.name} (${customer.email})</div>
          <div><strong>Telefoon:</strong> ${customer.phone || "-"}</div>
          <div><strong>Lestype:</strong> ${customer.lessonType || "-"}</div>
          <div style="margin-top:8px"><strong>Hond:</strong> ${dog.name} (${dog.breed || "-"})</div>
        </div>
      </div>
    `;

    // leeg formulier (preview laten staan)
    formEl.reset();
  } catch (err) {
    resultBox.innerHTML = `<div class="err">✖ ${err.message}</div>`;
  }
});
