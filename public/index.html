// public/app.js
const formEl = document.getElementById("register-form");
const dogFileEl = document.getElementById("dogPhoto");
const previewBox = document.getElementById("dog-preview");
const resultBox = document.getElementById("result");
const reloadBtn = document.getElementById("reloadBtn");

// Preview van de gekozen foto
dogFileEl.addEventListener("change", () => {
  const file = dogFileEl.files?.[0];
  if (!file) {
    previewBox.innerHTML = "Nog geen foto geselecteerd.";
    return;
  }
  const url = URL.createObjectURL(file);
  previewBox.innerHTML = `<img src="${url}" alt="Voorbeeld hond" />`;
});

// Herladen knopje
reloadBtn.addEventListener("click", () => location.reload());

// Submit: multipart/form-data met FormData (inclusief foto)
formEl.addEventListener("submit", async (e) => {
  e.preventDefault();
  resultBox.textContent = "Versturen…";

  const fd = new FormData(formEl);

  // voeg foto toe (name="dogPhoto" komt al uit index.html)
  if (dogFileEl.files?.[0]) {
    fd.set("dogPhoto", dogFileEl.files[0]);
  }

  try {
    const res = await fetch("/api/customers/register", {
      method: "POST",
      body: fd
      // géén headers hier — browser zet multipart boundary zelf
    });

    const data = await res.json();
    if (!res.ok) {
      throw new Error(data?.error || "Onbekende fout");
    }

    // Toon resultaat
    const { customer, dog } = data;
    const photo = dog?.photoUrl
      ? `<img src="${dog.photoUrl}" alt="hond" style="max-width:120px;border-radius:8px;border:1px solid #334155" />`
      : "<em>geen foto</em>";

    resultBox.innerHTML = `
      <div class="ok"><strong>✔ Geregistreerd!</strong></div>
      <div style="display:flex; gap:16px; align-items:flex-start; margin-top:8px">
        <div>${photo}</div>
        <div>
          <div><strong>Klant:</strong> ${customer.name} (${customer.email})</div>
          <div><strong>Telefoon:</strong> ${customer.phone || "-"}</div>
          <div><strong>Lestype:</strong> ${customer.lessonType || "-"}</div>
          <div style="margin-top:8px"><strong>Hond:</strong> ${dog.name} (${dog.breed || "-"})</div>
        </div>
      </div>
    `;

    // leeg formulier (preview laten staan)
    formEl.reset();
  } catch (err) {
    resultBox.innerHTML = `<div class="err">✖ ${err.message}</div>`;
  }
});
